# AGENTS.md

## 🎯 Purpose

이 문서는 이 저장소에서 작업하는 **Agent(코드 에이전트)**와 **개발자**가 반드시 따라야 하는 작업 규칙을 정의합니다.
이 파일은 사람이 읽기 위한 문서이면서 동시에, 자동화된 코딩 에이전트가 **행동 규칙으로 직접 해석**하는 기준 문서입니다.

아래 규칙을 하나라도 위반한 변경은 **PR 리뷰에서 즉시 반려**됩니다.

---

## 🧩 Environment Requirements

* 작업 시작 전 항상 가상환경을 활성화합니다.

```bash
source .venv/bin/activate
```

* VSCode + **Pylance** 사용을 강제합니다.
* 타입 체크 설정은 반드시 `pyproject.toml`에서 관리합니다.
* `pyrightconfig.json` 사용을 금지합니다.

```toml
[tool.pyright]
typeCheckingMode = "basic"
```

목표: **Pylance 기준 Type Error 0**

---

## 📝 Language & Documentation

* 모든 **주석과 문서**는 한국어로 작성합니다.
* 주석은 코드 이해에 **실질적인 도움이 되는 경우에 적절히 작성**합니다.
* 로직이 복잡하거나, 처음 읽는 사람이 오해할 수 있거나, **외부 문서·스펙·이슈를 참고한 경우**에는 주석을 반드시 추가합니다.
* 단순하고 자명한 코드에 불필요한 주석을 과도하게 추가하지 않습니다.
* 함수 이름만으로 의도가 완전히 전달되지 않는 경우에는 로직 설명 주석을 보완합니다.
* 주석을 작성할 때는 다음 중 하나 이상을 명확히 설명해야 합니다.
* 가독성 향상을 목적으로 하는 경우, **주석 내 이모지 사용을 허용**합니다. (과도한 사용은 지양)

  * 코드의 의도
  * 처리 흐름에서 주의해야 할 핵심 포인트
  * 왜 이러한 구현 방식을 선택했는지에 대한 이유

---

## 🧠 Programming Style

* 로직이 짧고 간결하며 상태 관리가 필요 없는 경우에는 **함수형 프로그래밍 패러다임**을 사용합니다.
* 로직이 복잡하거나 코드 규모가 크고, 명확한 **상태 관리가 필요한 경우에는 객체지향 프로그래밍 패러다임(OOP)**을 사용합니다.
* 전역 상태 사용을 금지합니다.
* 사이드 이펙트를 최소화합니다.
* 암묵적 동작을 금지하고, **명시적 로직**을 사용합니다.
* **코드는 항상 불필요하게 길어지지 않도록 작성해야 합니다.**
* 동일한 동작을 더 적은 코드로 표현할 수 있다면, 반드시 더 단순한 방식으로 작성합니다.
* 불필요한 추상화, 과도한 유틸리티 함수, 과한 계층 분리는 금지합니다.
* 가독성을 해치지 않는 범위 내에서, 가장 간결한 구현을 우선합니다.

---

## 🧬 Type Hint & PEP Compliance Rules

* 본 저장소의 모든 코드는 **PEP 규칙을 엄격히 준수**하여 일관성을 유지해야 합니다.
* 특히 아래 PEP을 필수 기준으로 합니다.

### 필수 준수 PEP

* **PEP 8**: 코드 스타일 및 포맷 (들여쓰기, 네이밍, 라인 길이 등)
* **PEP 257**: Docstring 작성 규칙
* **PEP 484**: 타입 힌트(Type Hints)
* **PEP 526**: 변수 어노테이션(Variable Annotations)
* **PEP 544**: 프로토콜 기반 서브타이핑(Structural Subtyping / Protocol)

이들 규칙을 위반하여 코드 스타일·타입·문서화가 불일치할 경우 PR은 반려됩니다.

### 타입 힌트 세부 규칙

* 타입 힌트는 내장 타입을 우선 사용합니다.

  * `list`, `dict`, `set`, `tuple`, `str`, `int`, `float`, `bool`
* 모호한 타입은 `typing.cast`로 명시합니다.
* `**kwargs` 전달을 금지하며, 필요한 인자를 명시적으로 선언합니다.
* 상태나 인터페이스 계약이 중요한 경우에는 `typing.Protocol` 사용을 권장합니다.

### 🔧 Stub 한계 우회 예시

```python
nn.Module.to(model, device)
```

---

## 🧪 Testing Rules

다음을 만족하지 않으면 PR은 반려됩니다.

* 코드 변경 시 **반드시 테스트 코드 포함**
* 테스트 실패 상태에서의 커밋 및 PR은 **절대 금지**
* 테스트는 단순 호출 확인이 아닌 **의미 있는 시나리오 기반**이어야 합니다.
* 반드시 다음 유형을 포함해야 합니다.

  * 정상 케이스
  * 경계값 케이스
  * 실패/예외 케이스

```bash
pytest -q
```

---

## 🧾 Commit Rules

다음을 만족하지 않으면 PR은 반려됩니다.

* 커밋 메시지는 **Gitmoji**를 사용합니다.
* 타입(이모지)을 제외한 제목과 본문은 한국어로 작성합니다.
* 하나의 커밋에는 하나의 논리적 변경만 포함해야 합니다.

예시:

```
✨ 기능: 데이터 전처리 파이프라인 추가
🧪 테스트: 엣지 케이스 시나리오 보강
```

---

## 🚨 Exception Handling

예외가 필요한 경우에도 아래 규칙을 지키지 않으면 PR은 반려됩니다.

* 타입 시스템 또는 라이브러리 스텁의 한계로 우회가 필요한 경우, **주석으로 이유를 명확히 설명**해야 합니다.
* 임시 우회 코드는 반드시 TODO와 함께 남깁니다.

```python
# TODO: 라이브러리 타입 스텁 개선 시 원래 호출로 복구
```

---

이 문서는 이 저장소의 **코드 품질, 테스트 신뢰성, 정적 분석 통과율**을 강제하기 위한 기준입니다.
